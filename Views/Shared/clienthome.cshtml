@model GRC_NewClientPortal.Models.ClienthomeModel
@{
	Layout = null; // ✅ ensures no master layout is used
	ViewData["Title"] = "General Revenue Corporation :: Clients Access, Home";
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>@ViewData["Title"]</title>

	<!-- Styles -->
	<link rel="stylesheet" href="css/style.css" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


	<style>
		.newStyle1 {
			margin: 3px;
		}
	</style>

	<!-- Scripts -->
	<script type="text/javascript">
		function swapImgRestore() {
			var i, x, a = document.MM_sr;
			for (i = 0; a && i < a.length && (x = a[i]) && x.oSrc; i++)
				x.src = x.oSrc;
		}

		function preloadImages() {
			console.log("Image in ");
			var d = document;
			if (d.images) {
				if (!d.MM_p) d.MM_p = [];
				var a = arguments;
				for (var i = 0; i < a.length; i++)
					if (a[i].indexOf("#") !== 0) {
						var img = new Image();
						img.src = a[i];
						d.MM_p.push(img);
					}
			}
		}

		function findObj(n, d) {
			var p, i, x;
			if (!d) d = document;
			if ((p = n.indexOf("?")) > 0 && parent.frames.length) {
				d = parent.frames[n.substring(p + 1)].document;
				n = n.substring(0, p);
			}
			if (!(x = d[n]) && d.all) x = d.all[n];
			for (i = 0; !x && i < d.forms.length; i++) x = d.forms[i][n];
			for (i = 0; !x && d.layers && i < d.layers.length; i++)
				x = findObj(n, d.layers[i].document);
			if (!x && d.getElementById) x = d.getElementById(n);
			return x;
		}

		function swapImage() {
			var i, j = 0, x, a = swapImage.arguments;
			document.MM_sr = new Array();
			for (i = 0; i < (a.length - 2); i += 3)
				if ((x = findObj(a[i])) != null) {
					document.MM_sr[j++] = x;
					if (!x.oSrc) x.oSrc = x.src;
					x.src = a[i + 2];
				}
		}

		document.addEventListener("DOMContentLoaded", function () {
			preloadImages(
				'/images/global/nav/nav_clients_over.gif',
				'/images/global/nav/nav_accountHolders_over.gif',
				'/images/global/nav/nav_about_over.gif',
				'/images/global/nav/nav_employment_over.gif'
			);
		});
	</script>
</head>

<body onload="preloadImages('images/global/nav/nav_clients_over.gif','images/global/nav/nav_accountHolders_over.gif','images/global/nav/nav_about_over.gif','images/global/nav/nav_employment_over.gif')">
	<table align="center">
		<tr>
			<td>
				<table cellspacing="0" cellpadding="0" width="690" align="left" border="0">
					<tr>
						<td valign="top" align="left" height="114">
							<table>
								<tr>
									<td colspan="3" height="91"><a href="FW/menu.aspx"><img height="95" alt="Home" src="images/home/logo_home.gif" width="223" border="0"></a></td>
								</tr>
								<tr>
									<td width="71"></td>
									<td width="96">
										<a href="FW/menu.aspx">
											<img height="15" alt="Homepage" src="images/global/nav/top_icons_r1_c1.gif" width="13"
												 border="0">
										</a><a href="contact.aspx">
											<img height="15" alt="Contact Us" src="images/global/nav/top_icons_r1_c2.gif" width="20"
												 border="0">
										</a><<a href="search.htm">
											<img height="15" alt="Search" src="images/global/nav/top_icons_r1_c4.gif" width="17"
												 border="0">
										</a>
									</td>
									<td width="50"></td>
								</tr>
							</table>
						</td>
						<td><img src="images/home/hdr_home.gif"></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td>
				<table width="690" align="left">
					<tr>
						<!--
						<td colspan="2">
							<div align="center">
								<a onmouseover="MM_swapImage('Clients','','images/global/nav/nav_clients_over.gif',1)"
								   onmouseout="MM_swapImgRestore()" href="clienthome.aspx"><img height="27" src="images/global/nav/nav_clients.gif" width="159" border="0" name="Clients"></a>
								<a onmouseover="MM_swapImage('Borrowers','','images/global/nav/nav_accountHolders_over.gif',1)"
								   onmouseout="MM_swapImgRestore()" href="Borrowers.aspx"><img height="27" src="images/global/nav/nav_accountHolders.gif" width="159" border="0" name="Borrowers"></a>
								<a onmouseover="MM_swapImage('About','','images/global/nav/nav_about_over.gif',1)"
								   onmouseout="MM_swapImgRestore()" href="aboutus.htm"><img height="27" src="images/global/nav/nav_about.gif" width="159" border="0" name="About"></a>
								<a onmouseover="MM_swapImage('Employment','','images/global/nav/nav_employment_over.gif',1)"
								   onmouseout="MM_swapImgRestore()" href="employment.htm"><img height="27" src="images/global/nav/nav_employment.gif" width="159" border="0" name="Employment"></a>
							</div>
						</td>-->
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td>
				<table width="690">
					<tr>
						<td width="690">
							<!-- InstanceBeginEditable name="content" -->
							<table cellspacing="0" cellpadding="0" border="0" height="300">
								<tr>
									<td class="clientlefttable" valign="top" td>
										<table cellspacing="0" cellpadding="0" width="100%" border="0">
											<tr>
												<td valign="top" width="13"></td>
											</tr>
											<tr>
												<td width="139" colspan="2"><img height="12" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
											</tr>
											<tr>
												<td colspan="2"><a href="mailto:<%=APG.ClientPortal.Domain.ClientCommon.CSREmail(Page)%>"><img height="56" src="images/global/bannerQuestions2.gif" width="81" border="0"></a></td>
											</tr>
											<tr>
												<td colspan="2">&nbsp;</td>
											</tr>
											<tr>
												@* <td colspan="2">
													<div align="left"><a href="http://www.upromise.com/slm-grwebsite"><img src="images/clients/upromise.gif" width="81" height="34" border="0"></a></div>
												</td> *@
												<td colspan="2">&nbsp;</td>
											</tr>
											<tr>
												<td colspan="2">&nbsp;</td>
											</tr>
										</table>
									</td>
									<td class="clientcentertable" valign="top">
										<table cellspacing="0" cellpadding="0" width="100%" border="0">
											<tr>
												<td valign="top" width="20" background="images/global/bkgdVertLine.gif" height="21"><img hspace="0" src="images/global/topLeftCurve.gif" vspace="0" border="0"></td>
												<td valign="top" width="100%" height="21">
													<table cellspacing="0" cellpadding="0" width="100%" border="0">
														<tr>
															<td bgcolor="#bdbdbd"><img height="1" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
														</tr>
														<tr>
															<td height="21"><img height="20" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
														</tr>
													</table>
												</td>
												<td width="1" bgcolor="#bdbdbd" height="21"><img height="1" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
												<td width="1" bgcolor="#bdbdbd" height="21" rowspan="2"><img height="1" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
											</tr>
											<tr>
												<td width="20" background="images/global/bkgdVertLine.gif"><img height="375" hspace="0" src="images/global/spacer.gif" width="20" vspace="0" border="0"></td>
												<td valign="top" width="100%">
													<table width="100%" border="0">
														<tr>
															<td valign="top"><img height="24" src="images/clients/headerClientAccess.gif" width="155"></td>
														</tr>
														<tr>
															<td valign="top "><img height="12" hspace="0" src="images/global/spacer.gif" width="20" vspace="0" border="0"></td>
														</tr>
														<tr>
															<td valign="top" background="images/global/bkgdPlusSigns.gif"><img height="1" hspace="0" src="images/global/spacer.gif" width="20" vspace="0" border="0"></td>
														</tr>
													</table>
													<P>
														<center><font color="#0000ff"><b>IMPORTANT MESSAGE</b></font></center>
														<font color="#0000ff">
															-To ensure you receive all of GRC's important email
															messages, please be certain to mark emails coming from &quot;Clientservicesmailbox&quot;
															as being safe.<br />
															-If you forget your login information, please use &#8220;Forgot Password?&#8221;
															below. Otherwise, after five attempts, your account will be locked and you will
															need to contact your Client Services Representative for assistance.
														</font>
													<P></P>
													<P>
														Please enter the sign-on and password provided by your Client Services
														Representative, along with your last name.&nbsp; <font color="#ff0300">
															Please
															note that Password is Case Sensitive.
														</font>
													</P>
													<p></p>

													<div class="login-container">

														<div id="loginDiv" style="@(Model.ShowMFA ? "display:none;" : "")">
															<!-- Dedicated error div -->
															<div id="clientError" class="alert alert-danger mt-3 text-center fw-bold" style="display:none;"></div>

															<div>
																<label>Client Login</label>
																<input asp-for="Signon" class="form-control" />
															</div>
															<div>
																<label>Last Name</label>
																<input asp-for="LName" class="form-control" />
															</div>
															<div>
																<label>Password</label>
																<input asp-for="Password" type="password" class="form-control" />
															</div>

															<button type="submit" class="btn btn-primary" onclick="clienthome()">Login</button>
														</div>

														<div id="mfaDiv" style="@(Model.ShowMFA ? "" : "display:none;")">
															<div>
																<label>Two-Step Verification</label>
																<p>@Model.Message</p>
															</div>
															<div>
																<label>Enter MFA Code</label>
																<input asp-for="MFACode" class="form-control" />
															</div>

															<button type="submit" class="btn btn-primary" onclick="VerifyMFA()">Verify</button>
														</div>

													</div>

													<p></p>
												</td>
												<td width="1" bgcolor="#bdbdbd"><img height="1" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
											</tr>
											<tr>
												<td width="1" bgcolor="#bdbdbd" colspan="5"><img height="1" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
											</tr>
											<tr>
												<td width="1" colspan="5"><img height="10" hspace="0" src="images/global/spacer.gif" width="1" vspace="0" border="0"></td>
											</tr>
											<tr>
												<td colspan="5">
													<table cellspacing="5" cellpadding="0" width="100%" border="0">
														<tr>
															<td class="ftr_menu" colspan="2">
																<a class="ftr_menu" href="FW/menu.aspx">Home</a> | <a class=ftr_menu href="contact.aspx">
																	Contact Us
																</a> @* | <a class="ftr_menu" href="faq.htm">FAQs</a> | <a class="ftr_menu" href="employment.htm">
																	Employment
																</a>&nbsp; *@| <a class="ftr_menu" href="Terms%20and%20conditions.htm">
																	Terms &amp; Conditions
																</a>
															</td>
														</tr>
														<tr>
															<td class="ftr_copyright">
																General Revenue Corporation <img border="0" src="images/Global/nav/ftr_dot.gif">
																4660 Duke Drive, Suite 200
																<img border="0" src="images/Global/nav/ftr_dot.gif"> Mason, OH 45040-8466<br>
																© Copyright @DateTime.Now.Year  All rights reserved.<br>
																<a class="ftr_copyrightLink" href="privacy.htm">Privacy Notice</a>
															</td>
															@* 
															<td valign="top" class="ftr_copyright"><a href="http://www.Navient.com/" target="_blank"><img src="images/global/Navient_73x38.gif" width="73" height="38" border="0"></a></td> *@
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
							<!-- InstanceEndEditable -->
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
	<!-- Hidden field for browser version -->
	<input type="hidden" id="hdnBrowserVersionClt" name="hdnBrowserVersionClt" />
	<script language="javascript" type="text/javascript">
		navigator.sayswho = (function() {
			var ua = navigator.userAgent,
			N = navigator.appName, tem,
			M = ua.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*([\d\.]+)/i) || [];
			M = M[2] ? [M[1], M[2]] : [N, navigator.appVersion, '-?'];
			if (M && (tem = ua.match(/version\/([\.\d]+)/i)) != null) M[2] = tem[1];
			return M.join(' ');
		})();
		document.getElementById('hdnBrowserVersionClt').value = navigator.sayswho;

	</script>
	<!-- SiteCatalyst code version: H.20.3.
	Copyright 1997-2009 Omniture, Inc. More info available at
	http://www.omniture.com -->
	<!-- SiteCatalyst / Omniture Analytics -->
	<script type="text/javascript" src="~/scripts/s_code.js"></script>
	<script type="text/javascript">
		// Page variables for SiteCatalyst
		var s = s || {};
		s.pageName = "";
		s.server = "";
		s.channel = "GRC";
		s.pageType = "";
		s.prop1 = "";
		s.prop2 = "";
		s.prop3 = "";
		s.prop4 = "";
		s.prop5 = "";

		// Conversion variables
		s.campaign = "";
		s.state = "";
		s.zip = "";
		s.events = "";
		s.products = "";
		s.purchaseID = "";
		s.eVar1 = "";
		s.eVar2 = "";
		s.eVar3 = "";
		s.eVar4 = "";
		s.eVar5 = "";

		// Trigger SiteCatalyst tracking
		try {
			var s_code = s.t();
			if (s_code) {
				// Append tracking code safely
				var span = document.createElement("span");
				span.innerHTML = s_code;
				document.body.appendChild(span);
			}
		} catch (e) {
			console.error("SiteCatalyst tracking error:", e);
		}
	</script>

	<!-- Google Analytics (legacy) -->
	<script async src="https://www.google-analytics.com/ga.js"></script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-6408068-1");
			pageTracker._trackPageview();
		} catch (err) {
			console.error("GA tracking error:", err);
		}
	</script>

	<script>
		async function clienthome() {
			console.log("clienthome() called");

			const signonInput = document.getElementById('Signon');
			const lnameInput = document.getElementById('LName');
			const passwordInput = document.getElementById('Password');

			if (!signonInput || !lnameInput || !passwordInput) {
				console.error("One or more input fields not found!");
				return;
			}

			const model = {
				Signon: signonInput.value.trim(),
				LName: lnameInput.value.trim(),
				Password: passwordInput.value.trim(),
				BrowserVersion: document.getElementById('hdnBrowserVersionClt').value
			};

			try {
				console.log("Sending fetch request to /Clienthome/clienthome...");

				const response = await fetch('/Clienthome/clienthome', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(model)
				});

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const data = await response.json();
				console.log("Response data:", data);

				// Show error message
				const errorDiv = document.getElementById('clientError');
				if (errorDiv) {
					if (data.errorMessage) {
						errorDiv.innerHTML = data.errorMessage;
						errorDiv.style.display = 'block';
					} else {
						errorDiv.innerHTML = '';
						errorDiv.style.display = 'none';
					}
				}

				// Toggle Login/MFA divs
				document.getElementById('loginDiv').style.display = data.showMFA ? 'none' : '';
				document.getElementById('mfaDiv').style.display = data.showMFA ? '' : 'none';

				// Update MFA message
				const mfaMessage = document.getElementById('mfaMessage');
				if (mfaMessage && data.Message) {
					mfaMessage.innerText = data.Message;
				}

			} catch (err) {
				console.error("Fetch error:", err);
				alert('An error occurred. Please check the console.');
			}
		}
	</script>
	
	<!-- InstanceEnd -->
</body>
</html>

