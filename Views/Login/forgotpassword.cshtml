@model GRC_NewClientPortal.Models.ForgotPasswordModel
@{
	Layout = null; // No master layout
	ViewData["Title"] = "General Revenue Corporation :: Clients Access, Home";
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>@ViewData["Title"]</title>
	<link rel="stylesheet" href="/css/style.css?v=@DateTime.Now.Ticks" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	


	<script type="text/javascript">
		function MM_swapImgRestore() {
			var i, x, a = document.MM_sr;
			for (i = 0; a && i < a.length && (x = a[i]) && x.oSrc; i++)
				x.src = x.oSrc;
		}

		function MM_preloadImages() {
			var d = document;
			if (d.images) {
				if (!d.MM_p) d.MM_p = [];
				var i, j = d.MM_p.length, a = MM_preloadImages.arguments;
				for (i = 0; i < a.length; i++)
					if (a[i].indexOf("#") != 0) {
						d.MM_p[j] = new Image;
						d.MM_p[j++].src = a[i];
					}
			}
		}

		function MM_findObj(n, d) {
			var p, i, x;
			if (!d) d = document;
			if ((p = n.indexOf("?")) > 0 && parent.frames.length) {
				d = parent.frames[n.substring(p + 1)].document;
				n = n.substring(0, p);
			}
			if (!(x = d[n]) && d.all) x = d.all[n];
			for (i = 0; !x && i < d.forms.length; i++) x = d.forms[i][n];
			for (i = 0; !x && d.layers && i < d.layers.length; i++)
				x = MM_findObj(n, d.layers[i].document);
			if (!x && d.getElementById) x = d.getElementById(n);
			return x;
		}

		function MM_swapImage() {
			var i, j = 0, x, a = MM_swapImage.arguments;
			document.MM_sr = [];
			for (i = 0; i < (a.length - 2); i += 3)
				if ((x = MM_findObj(a[i])) != null) {
					document.MM_sr[j++] = x;
					if (!x.oSrc) x.oSrc = x.src;
					x.src = a[i + 2];
				}
		}
	</script>
</head>

	<body> 
	<div class="auth-page-content">
	<div class="top-bar">
		<div class="top-links">
				<a asp-controller="Home" asp-action="Index">Home</a>
			<a href="search.htm">Search</a>
			<a href="contact.aspx">Contact Us</a>
		</div>
	</div>

	<header class="main-header">
		<div class="header-left">
			<a href="FW/menu.aspx">
				<img src="/images/home/logo_home2.png" alt="Home" height="60">
			</a>
		</div>

		@* <img src="images/home/total_logo.png"> *@

		@* <nav class="header-nav">
			<a href="whatwedo.aspx">What We Do</a>
			<a href="#">Who We Serve</a>
			<a href="#">Who We Are</a>
			<a href="#">Careers</a>
		</nav> *@
	</header>
		<section class="auth-page-section">
			<div class="auth-form-card">

				<h2 class="auth-form-title">Reset Your Password</h2>

			@* <div id="message" class="error-message" style="color:red;"></div> *@
				<div id="message" class="text-center fw-semibold mb-2 text-danger"></div>

				<div class="auth-form-field">
				<label>Client Login</label>
				<input type="text" id="signon" />
			</div>

				<div class="auth-form-field">
				<label>Last Name</label>
				<input type="text" id="lname" />
			</div>

				<div class="auth-form-field">
				<label>Mother’s Maiden Name</label>
				<input type="text" id="maidenName" />
			</div>

				<div class="auth-form-field">
				<label>Email Address</label>
				<input type="email" id="email" />
			</div>

			<div class="button-group">
					<button class="btn-common btn-primary-common" id="resetBtn" onclick="resetPassword()">Reset Password</button>
					<button class="btn-common btn-secondary-common" onclick="clearAll()">Clear All</button>
			</div>

		</div>
	</section>
	<script>
							function ClearAll()
							{
								document.getElementById('txtSignon').value="";
								document.getElementById('txtLName').value="";
								document.getElementById('txtMaidenName').value="";
								document.getElementById('txtEmail').value="";
								document.getElementById('btnReset').disabled=false;
							}
								</script>
								
										
													@* <div class="forgot-password-container">
														<h2>Reset Your Password</h2>

														<div id="message" style="color:red;"></div>

														<div class="form-field">
															<label for="signon">Client Login:</label>
															<input type="text" id="signon" class="form-control" />
														</div>

														<div class="form-field">
															<label for="lname">Your Last Name:</label>
															<input type="text" id="lname" class="form-control" />
														</div>

														<div class="form-field">
															<label for="maidenName">Mother's Maiden Name:</label>
															<input type="text" id="maidenName" class="form-control" />
														</div>

														<div class="form-field">
															<label for="email">E-mail Address:</label>
															<input type="email" id="email" class="form-control" />
														</div>

														<div class="button-group">
															<button type="button" id="resetBtn" onclick="resetPassword()">Reset Password</button>
															<button type="button" onclick="clearAll()">Clear All</button>
														</div>
													</div> *@
													
								
	</div>
	<!-- FOOTER -->
	<footer class="site-footer">
		<div class="footer-links">
			<a href="FW/menu.aspx">Home</a> |
			<a href="contact.aspx">Contact Us</a> |
			<a href="Terms%20and%20conditions.htm">Terms & Conditions</a>
		</div>

		<div class="footer-copy">
			General Revenue Corporation • 4660 Duke Drive, Suite 200 • Mason, OH 45040-8466<br>
			© Copyright @DateTime.Now.Year — All rights reserved.<br>
			<a href="privacy.htm">Privacy Notice</a>
		</div>
	</footer>
		<!-- SiteCatalyst code version: H.20.3.
		Copyright 1997-2009 Omniture, Inc. More info available at
		http://www.omniture.com -->
	     <script language="JavaScript" type="text/javascript" src="~/js/s_code.js"></script>
		<script language="JavaScript" type="text/javascript"><!--
		/* You may give each page an identifying name, server, and channel on
		the next lines. */
				
		s.pageName=""
		s.server=""
		s.channel="GRC"
		s.pageType=""
		s.prop1=""
		s.prop2=""
		s.prop3=""
		s.prop4=""
		s.prop5=""
		/* Conversion Variables */
		s.campaign=""
		s.state=""
		s.zip=""
		s.events=""
		s.products=""
		s.purchaseID=""
		s.eVar1=""
		s.eVar2=""
		s.eVar3=""
		s.eVar4=""
		s.eVar5=""
		/************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
		var s_code=s.t();if(s_code)document.write(s_code)//--></script>
		<!--/DO NOT REMOVE/-->
		<!-- End SiteCatalyst code version: H.20.3. -->	
		<!-- Google Analytics -->
		<script type="text/javascript">
			var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
			document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		</script>
		<script type="text/javascript">
			try 
			{
				var pageTracker = _gat._getTracker("UA-6408068-1");
				pageTracker._trackPageview();
			}
			catch(err) 
			{
			}
		</script>
		<!-- InstanceEnd -->

	<script>
		async function resetPassword() {
			console.log("inside resetPassword fucntion");
			 const resetBtn = document.getElementById('resetBtn');
			 resetBtn.disabled = true;
	
			const model = {
				Signon: document.getElementById("signon").value.trim(),
				LastName: document.getElementById("lname").value.trim(),
				MaidenName: document.getElementById("maidenName").value.trim(),
				Email: document.getElementById("email").value.trim()
			};
			//console.log($"Signon: {model.Signon}, LName: {model.LName}, MaidenName: {model.MaidenName}, Email: {model.Email}");

			// Basic validation
			if (!model.Signon || !model.LastName || !model.MaidenName || !model.Email) {
				document.getElementById("message").innerText = "All fields are required.";
				resetBtn.disabled = false; // Re-enable button
				return;
			}

			try {
				console.log("Sending fetch request to /Login/ResetPassword...");
				const response = await fetch('/Login/ResetPassword', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(model)
				});

				console.log("Just before await response.json");
				const result = await response.json();
				document.getElementById("message").style.color = result.success ? "green" : "red";
				document.getElementById("message").innerText = result.message;

						// Disable reset button only if mail sent successfully
		if (result.success) {
			resetBtn.disabled = true;
		} else {
			resetBtn.disabled = false;
		}
			} catch (error) {
				console.error("Error during password reset:", error);
				document.getElementById("message").innerText = "An error occurred while resetting the password.";
				resetBtn.disabled = false; // Re-enable button on error
			} 
		}

		function clearAll() {
			["signon", "lname", "maidenName", "email"].forEach(id => {
				document.getElementById(id).value = "";
			});
			document.getElementById("message").innerText = "";
		}
	</script>
	</body>
</html>
